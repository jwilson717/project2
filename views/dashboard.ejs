<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Dashboard</title>
   <link rel="stylesheet" type='text/css' href="/css/bootstrap.css">
   <link rel="stylesheet" type='text/css' href="/css/styles.css">
   <link rel="stylesheet" type='text/css' href="/css/dashboardStyles.css">
</head>
<body>
   <div id='header' class='shadow-sm p-3 overflow-auto'>
      <h1>Movie Catalog</h1>
      <p class='ml-3'>Welcome <%= user%></p>
      <button type='button' class="btn btn-primary float-right" data-toggle='modal' data-target='#newMovie'>Add Movie</button>
   </div>
   <main class='container'>
      <form id='searchform'>
         <div class='row'>
            <div class='form-group input-group m-2'>
               <input type="text" name="username" id="username" class='hide' value=<%= user %>>
               <input type="text" name="search" id="search" class='form-control' placeholder="Search">
               <button type='button' class='btn btn-light' id='searchbtn'><img src="search_icon.png" alt="search icon" width="20" height="20"></button>
            </div>
         </div>
      </form>
      <div id='results'></div>
      <div class='modal fade' id='newMovie' role='dialog'>
         <div class='modal-dialog modal-dialog-centered'>
            <div class='modal-content'>
               <div class='modal-header'>
                  <h3 class='modal-title' id='newMovieTitle'>Add Movie</h3>
                  <button type="button" class="close" data-dismiss="modal">
                     <span aria-hidden="true">&times;</span>
                   </button>
               </div>
               <div class='modal-body'>
                  <form id='newMovieForm'>
                     <div class='form-group input-group'>
                        <input type="text" name="title" id="title" class='form-control' placeholder="Title" required>
                     </div>
                     <div class='form-group input-group'>
                        <input type="text" name="year" id="year" class='form-control' placeholder="Release Year" required>
                     </div>
                     <div class='form-group input-group'>
                        <input type="text" name="description" id="description" class='form-control' placeholder="Description" required>
                     </div>
                     <button type='button' class='btn btn-primary' id='save'>Add</button>
                  </form>
               </div>
               <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
               </div>
            </div>
         </div>
      </div>
   </main>
   <script src='jquery-3.5.1.min.js'></script>
   <script src='bootstrap.js'></script>
   <script>
      $(document).ready(function () {
         $('#searchbtn').click(function () {
            let searchstr = $('#search').val();
            let name ='<%= user %>';
            let info = {username: name, search: searchstr};
            $.post('/search', info, function (data){
               let res = JSON.parse(data);
               let out = '';
               res.forEach(element => {
                  out += display(element);
               });
               $('#results').html(out);
            });
         });
      });

      function display(movie) {
         let out = "<div class='rounded shadow mt-2 p-2 result'><p>" 
            + movie.title + "</p><p class='ml-2'> " + movie.description + "</p></div>";
         return out;
      }
   </script>
</body>
</html>